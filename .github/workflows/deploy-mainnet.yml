name: Deploy Mainnet

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      network:
        description: 'Network to deploy to (leave empty for all)'
        required: false
        type: string

jobs:
  ci:
    uses: BreadchainCoop/etherform/.github/workflows/_ci.yml@main
    with:
      check-formatting: false

  deploy:
    needs: [ci]
    uses: BreadchainCoop/etherform/.github/workflows/_deploy-mainnet.yml@main
    with:
      network: ${{ inputs.network || '' }}
      flatten-contracts: true
    secrets:
      PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
      RPC_URL: ${{ secrets.RPC_URL }}
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
